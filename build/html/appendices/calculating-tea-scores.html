<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>Appendix: How TEA Scores Are Calculated &mdash; tranSMART User Guide 0.1 documentation</title>
    
    <link rel="stylesheet" href="../_static/alabaster.css" type="text/css" />
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../',
        VERSION:     '0.1',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="../_static/jquery.js"></script>
    <script type="text/javascript" src="../_static/underscore.js"></script>
    <script type="text/javascript" src="../_static/doctools.js"></script>
    <script type="text/javascript" src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
    <link rel="top" title="tranSMART User Guide 0.1 documentation" href="../index.html" />
    <link rel="next" title="&lt;no title&gt;" href="../tmug.html" />
    <link rel="prev" title="Appendix: Rules for Loading OmicSoft Data" href="loading-omicsoft-data.html" />
   
  <link rel="stylesheet" href="../_static/custom.css" type="text/css" />
  
  <meta name="viewport" content="width=device-width, initial-scale=0.9, maximum-scale=0.9" />

  </head>
  <body role="document">
  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <div class="section" id="appendix-how-tea-scores-are-calculated">
<h1>Appendix: How TEA Scores Are Calculated<a class="headerlink" href="#appendix-how-tea-scores-are-calculated" title="Permalink to this headline">¶</a></h1>
<p>This appendix summarizes the operations tranSMART performs to calculate
the overall TEA score for an experiment, and the data inputs that the
calculation requires. Pseudocode representations of the operations being
performed are included where they may clarify the operation.</p>
<div class="section" id="data-inputs-to-the-tea-algorithm">
<h2>Data Inputs to the TEA algorithm<a class="headerlink" href="#data-inputs-to-the-tea-algorithm" title="Permalink to this headline">¶</a></h2>
<p>One of the following:</p>
<ul class="simple">
<li>A gene signature or gene list containing any number of genes, with a
binary up- or down-regulation flag based on fold change.</li>
<li>A pathway containing any number of genes.</li>
</ul>
<p>And:</p>
<ul class="simple">
<li>A gene search result list for each signature, list, or pathway gene.
Result lists contain experimental comparisons.</li>
</ul>
</div>
<div class="section" id="operations">
<h2>Operations<a class="headerlink" href="#operations" title="Permalink to this headline">¶</a></h2>
<ol class="arabic">
<li><p class="first">Compute the average fold change and standard deviation for all
genes in the comparison.</p>
</li>
<li><p class="first">Compute a normalized p-value (NPV) for each gene in the
comparison, based on its fold change (fc) value, and the above
average (ave) and standard deviation (std) values. Use a normal
distribution function (CDF):</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="k">if</span> <span class="p">(</span><span class="n">fc</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span>

<span class="n">NPV</span> <span class="o">=</span> <span class="mf">1.0</span> <span class="o">-</span> <span class="n">CDF</span><span class="p">(</span><span class="n">fc</span><span class="p">,</span> <span class="n">ave</span><span class="p">,</span> <span class="n">std</span><span class="p">)</span>

<span class="k">else</span>

<span class="n">NPV</span> <span class="o">=</span> <span class="mf">1.0</span> <span class="o">-</span> <span class="n">CDF</span><span class="p">(</span><span class="o">-</span><span class="n">fc</span><span class="p">,</span> <span class="n">ave</span><span class="p">,</span> <span class="n">std</span><span class="p">)</span>

<span class="k">if</span> <span class="n">NPV</span> <span class="o">&lt;</span> <span class="mf">1.0e-15</span><span class="p">,</span> <span class="nb">set</span> <span class="n">to</span> <span class="mf">1.0e-15</span>
</pre></div>
</div>
</li>
<li><p class="first">For each gene in the gene signature, list, or pathway, search against
experimental comparisons and extract those comparisons where the
gene’s normalized p-value is less than 0.05. This returns a
comparison list.</p>
</li>
<li><p class="first">Iterate through the comparison list. For each comparison (C), add the
normalized p-value to one of two arrays of sums (<cite>pv_sum</cite>), as
follows:</p>
<ul class="simple">
<li>For gene signatures and gene lists, add the gene’s normalized p-value to:</li>
<li><code class="docutils literal"><span class="pre">pv_sum(C,</span> <span class="pre">up)</span></code> if the gene’s fold change in the signature (svc)
<em>and</em> in the comparison (cfc) are co-regulated.</li>
<li><code class="docutils literal"><span class="pre">pv_sum(C,</span> <span class="pre">down)</span></code> if the gene’s fold change in the signature <em>and</em>
in the comparison are anti-regulated.</li>
<li>For pathways, add the gene’s normalized p-value to:</li>
<li><code class="docutils literal"><span class="pre">pv_sum(C,</span> <span class="pre">up)</span></code> if the gene’s comparison fold change (cfc) is
up-regulated.</li>
<li><code class="docutils literal"><span class="pre">pv_sum(C,</span> <span class="pre">down)</span></code> if the gene’s comparison fold change is
down-regulated.</li>
</ul>
<p>Also, use the logarithm of the normalized p-value to make the final TEA score more human readable:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="k">if</span> <span class="p">(</span><span class="n">gene_signature</span> <span class="n">OR</span> <span class="n">gene_list</span><span class="p">)</span>
  <span class="k">if</span> <span class="p">((</span><span class="n">sfc</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="n">AND</span> <span class="n">cfc</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span> <span class="n">OR</span> <span class="p">(</span><span class="n">sfc</span> <span class="o">&lt;</span> <span class="mi">0</span> <span class="n">AND</span> <span class="n">cfc</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">))</span>
    <span class="n">pv_sum</span><span class="p">(</span><span class="n">C</span><span class="p">,</span> <span class="n">up</span><span class="p">)</span> <span class="o">+=</span> <span class="o">-</span><span class="n">Math</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">NPV</span><span class="p">)</span>
    <span class="n">pv_count</span><span class="p">(</span><span class="n">C</span><span class="p">,</span> <span class="n">up</span><span class="p">)</span><span class="o">++</span>
  <span class="k">else</span>
    <span class="n">pv_sum</span><span class="p">(</span><span class="n">C</span><span class="p">,</span> <span class="n">down</span><span class="p">)</span> <span class="o">+=</span> <span class="o">-</span><span class="n">Math</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">NPV</span><span class="p">)</span>
    <span class="n">pv_count</span><span class="p">(</span><span class="n">C</span><span class="p">,</span> <span class="n">down</span><span class="p">)</span><span class="o">++</span>

<span class="k">if</span> <span class="p">(</span><span class="n">gene_pathway</span><span class="p">)</span>
  <span class="k">if</span> <span class="p">(</span><span class="n">cfc</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span>
    <span class="n">pv_sum</span><span class="p">(</span><span class="n">C</span><span class="p">,</span> <span class="n">up</span><span class="p">)</span> <span class="o">+=</span> <span class="o">-</span><span class="n">Math</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">NPV</span><span class="p">)</span>
    <span class="n">pv_count</span><span class="p">(</span><span class="n">C</span><span class="p">,</span> <span class="n">up</span><span class="p">)</span><span class="o">++</span>
  <span class="k">else</span>
    <span class="n">pv_sum</span><span class="p">(</span><span class="n">C</span><span class="p">,</span> <span class="n">down</span><span class="p">)</span> <span class="o">+=</span> <span class="o">-</span><span class="n">Math</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">NPV</span><span class="p">)</span>
    <span class="n">pv_count</span><span class="p">(</span><span class="n">C</span><span class="p">,</span> <span class="n">down</span><span class="p">)</span><span class="o">++</span>
</pre></div>
</div>
</li>
<li><p class="first">Compute the min-LogP average (pv_ave) for each sum:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">pv_ave</span><span class="p">(</span><span class="n">C</span><span class="p">,</span> <span class="n">up</span><span class="p">)</span> <span class="o">=</span> <span class="n">Math</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="n">pv_sum</span><span class="p">(</span><span class="n">C</span><span class="p">,</span><span class="n">up</span><span class="p">)</span> <span class="o">/</span> <span class="n">pv_count</span><span class="p">(</span><span class="n">C</span><span class="p">,</span><span class="n">up</span><span class="p">))</span>

<span class="n">pv_ave</span><span class="p">(</span><span class="n">C</span><span class="p">,</span> <span class="n">down</span><span class="p">)</span> <span class="o">=</span> <span class="n">Math</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="n">pv_sum</span><span class="p">(</span><span class="n">C</span><span class="p">,</span><span class="n">down</span><span class="p">)</span> <span class="o">/</span> <span class="n">pv_count</span><span class="p">(</span><span class="n">C</span><span class="p">,</span><span class="n">down</span><span class="p">))</span>
</pre></div>
</div>
</li>
<li><p class="first">Compute a TEA score (pv_tea) for each min-LogP average through a
binomial distribution function:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">pv_tea</span><span class="p">(</span><span class="n">C</span><span class="p">,</span> <span class="n">up</span><span class="p">)</span> <span class="o">=</span> <span class="mf">1.0</span> <span class="o">-</span> <span class="n">Binom</span><span class="p">(</span> <span class="n">N</span><span class="p">,</span> <span class="n">pv_count</span><span class="p">(</span><span class="n">C</span><span class="p">,</span><span class="n">up</span><span class="p">),</span> <span class="n">pv_ave</span><span class="p">(</span><span class="n">C</span><span class="p">,</span><span class="n">up</span><span class="p">))</span>

<span class="n">pv_tea</span><span class="p">(</span><span class="n">C</span><span class="p">,</span> <span class="n">down</span><span class="p">)</span> <span class="o">=</span> <span class="mf">1.0</span> <span class="o">-</span> <span class="n">Binom</span><span class="p">(</span> <span class="n">N</span><span class="p">,</span> <span class="n">pv_count</span><span class="p">(</span><span class="n">C</span><span class="p">,</span><span class="n">down</span><span class="p">),</span> <span class="n">pv_ave</span><span class="p">(</span><span class="n">C</span><span class="p">,</span><span class="n">down</span><span class="p">))</span>
</pre></div>
</div>
</li>
</ol>
</div>
<div class="section" id="result">
<h2>Result<a class="headerlink" href="#result" title="Permalink to this headline">¶</a></h2>
<ul class="simple">
<li><strong>TEA score</strong>: For gene signatures, lists, and pathways, the final
TEA score is the more significant pv_tea value (the lower of the two
pv_tea values).</li>
<li>A gene signature or list is determined to be co-regulated or
anti-regulated as follows:<ul>
<li><strong>Co-regulated</strong>: The more significant pv_tea value was derived
from the sums associated with co-regulated fold change values
(pv_sum(C, up)).</li>
<li><strong>Anti-regulated</strong>: The more significant pv_tea value was derived
from the sums associated with anti-regulated fold change values
(pv_sum(C, down)).</li>
</ul>
</li>
<li>A pathway is determined to be up-regulated or down-regulated as
follows:<ul>
<li><strong>Up-regulated</strong>: The more significant pv_tea value was derived
from the sums associated with up-regulated fold change values
(pv_sum(C, up)).</li>
<li><strong>Down-regulated</strong>: The more significant pv_tea value was derived
from the sums associated with down-regulated fold change values
(pv_sum(C, down)).</li>
</ul>
</li>
</ul>
</div>
</div>


          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
  <h3><a href="../index.html">Table Of Contents</a></h3>
  <ul>
<li><a class="reference internal" href="#">Appendix: How TEA Scores Are Calculated</a><ul>
<li><a class="reference internal" href="#data-inputs-to-the-tea-algorithm">Data Inputs to the TEA algorithm</a></li>
<li><a class="reference internal" href="#operations">Operations</a></li>
<li><a class="reference internal" href="#result">Result</a></li>
</ul>
</li>
</ul>
<div class="relations">
<h3>Related Topics</h3>
<ul>
  <li><a href="../index.html">Documentation overview</a><ul>
      <li>Previous: <a href="loading-omicsoft-data.html" title="previous chapter">Appendix: Rules for Loading OmicSoft Data</a></li>
      <li>Next: <a href="../tmug.html" title="next chapter">&lt;no title&gt;</a></li>
  </ul></li>
</ul>
</div>
  <div role="note" aria-label="source link">
    <h3>This Page</h3>
    <ul class="this-page-menu">
      <li><a href="../_sources/appendices/calculating-tea-scores.txt"
            rel="nofollow">Show Source</a></li>
    </ul>
   </div>
<div id="searchbox" style="display: none" role="search">
  <h3>Quick search</h3>
    <form class="search" action="../search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="footer">
      &copy;2016, Paul Agapow.
      
      |
      Powered by <a href="http://sphinx-doc.org/">Sphinx 1.4.1</a>
      &amp; <a href="https://github.com/bitprophet/alabaster">Alabaster 0.7.8</a>
      
      |
      <a href="../_sources/appendices/calculating-tea-scores.txt"
          rel="nofollow">Page source</a>
    </div>

    

    
  </body>
</html>